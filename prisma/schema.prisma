// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "../ERD.svg"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmklJob {
  id              Int       @id @default(autoincrement())
  jobNo           String    @unique // No. Order
  date            DateTime // Tgl. Order
  customer        String // Customer (Using string for now as we cleared Contacts)
  containerCount  Int // jmlh container
  origin          String? // ASAL
  destination     String? // Destination
  forwardingAgent String? // Forwarding
  shippingLine    String? // Pelayaran
  vesselName      String? // vessel
  voyageNo        String? // Voyage no.
  eta             DateTime? // tgl. msk pelabuhan
  submissionNo    String? // No.Aju
  jobInvoiceNo    String? // no. invoice_job
  pebNo           String? // no.peb
  pebDate         DateTime? // tgl Peb
  commodity       String? // komodti
  remarks         String? // keterangan

  containers Container[]
  dokumens   Dokumen[]
  invoices   Invoice[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Dokumen {
  id              Int      @id @default(autoincrement())
  receiptNo       String // No. Quitansi
  receiptDate     DateTime // Tgl Quitansi (was spDate)
  docType         String // Tipe Dokumen
  description     String? // Keterangan (was containerNo)
  transporterName String? // Pengangkutan
  docNo           String // No.Dokumen

  jobId Int
  job   EmklJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  cost        Decimal // Biaya
  paymentType String // Tipe pembayaran

  hutangs Hutang[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Hutang {
  id            Int       @id @default(autoincrement())
  noHutang      String // No. hutang
  date          DateTime // tgl
  paymentType   String // tipe pembayaran(cash or giro)
  giroNo        String? // no. giro/cek
  giroDate      DateTime? // tgl cair
  nominal       Decimal
  kodePerkiraan String
  namaPerkiraan String

  dokumenId Int
  dokumen   Dokumen @relation(fields: [dokumenId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Piutang {
  id            Int       @id @default(autoincrement())
  noPiutang     String // No. piutang
  date          DateTime // tgl
  paymentType   String // tipe pembayaran(cash or giro)
  giroNo        String? // no. giro/cek
  giroDate      DateTime? // tgl cair
  nominal       Decimal
  kodePerkiraan String
  namaPerkiraan String

  invoiceId Int
  invoice   Invoice @relation(fields: [invoiceId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum InvoiceItemType {
  INVOICE
  PAJAK
  REIMBURSEMENT
  KWITANSI
}

model Invoice {
  id        Int      @id @default(autoincrement())
  invoiceNo String   @unique
  date      DateTime @default(now())

  jobId Int
  job   EmklJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  customer    String
  destination String?
  commodity   String?
  vessel      String?
  voyageNo    String?
  paymentType String?

  items InvoiceItem[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  piutangs  Piutang[]
}

model InvoiceItem {
  id        Int     @id @default(autoincrement())
  invoiceId Int
  invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  type        InvoiceItemType
  description String
  qty         Int
  price       Decimal
  total       Decimal

  // Optional fields for specific types
  date DateTime? // For Pajak, Reimburse, Kwitansi
  dpp  Decimal? // For Pajak
  ppn  Decimal? // For Pajak

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Container {
  id    Int     @id @default(autoincrement())
  jobId Int
  job   EmklJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  sizeType        String? // tipe (20ft/40ft)
  containerNo     String? // no.container
  sealNo          String? // no.seal
  chassisNo       String? // gandeng
  transporterName String? // pengangkutan
  cost            Decimal? // ongkos
  location        String? // lokasi
  gateInDate      DateTime? // tgl masuk
  gateOutDate     DateTime? // tgl keluar
  deliveryOrderNo String? // no.Sp

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
